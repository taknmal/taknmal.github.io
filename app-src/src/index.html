<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="manifest" href="/assets/manifest.webmanifest"/>
    <link rel='dns-prefetch' href='//youtube.com'/>
    <link rel='dns-prefetch' href='//youtube-nocookie.com'/>
    <link rel='preconnect' href='https://youtube.com'/>
    <link rel='preconnect' href='https://youtube-nocookie.com'/>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/assets/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/assets/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/assets/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/assets/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/assets/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/assets/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/assets/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/assets/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/assets/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/assets/mstile-310x310.png" />
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2048-2732.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2732-2048.jpg" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1668-2388.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2388-1668.jpg" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1536-2048.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2048-1536.jpg" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1668-2224.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2224-1668.jpg" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1620-2160.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2160-1620.jpg" media="(device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1290-2796.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2796-1290.jpg" media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1179-2556.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2556-1179.jpg" media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1284-2778.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2778-1284.jpg" media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1170-2532.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2532-1170.jpg" media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1125-2436.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2436-1125.jpg" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1242-2688.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2688-1242.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-828-1792.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1792-828.jpg" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1242-2208.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-2208-1242.jpg" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-750-1334.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1334-750.jpg" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-640-1136.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/assets/apple-splash-1136-640.jpg" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)">


    <meta name="theme-color" content="white"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÍTM">

    <link rel="stylesheet" href="style.css">
    <link href='https://fonts.googleapis.com/css?family=Faustina' rel='stylesheet'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@200" rel="stylesheet" />
    <title>Íslenskt táknmál</title>
    <link rel="canonical" href="https://taknmal.github.io/" />
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

</head>
<body onload="handleHashUrl()">
    <script>
        // register ServiceWorker, remember to use absolute path!
        if (navigator.serviceWorker) {
          navigator.serviceWorker.register('/sw.js', {scope: '/'})
        }
    </script>

<article>
  <header>
    
    <span class="heading">Íslenskt táknmál</span>
    
    <div class="sign-search all-signs">
      <input type="search" name="" id="search-input" placeholder="Search for a sign" oninput="updateSearch()" onchange="updateSearch()">
    </div>
  </header>
  
  <main class="container">
    <div id="app"></div>
    <div class="search-results all-signs" id="results"></div>

          <div id="settings">
            <div class="row">
              <h1><span class="material-symbols-outlined">settings</span> Stillingar</h1>
            </div>
            <form>
              <div class="row row-border">
                <input type="text" name="" id=""><span>loloololo</span>
              </div>

              
              <div class="row row-border">
                <span>Dark mode</span>
                <label class="switch">
                  <input type="checkbox">
                  <span class="slider round"></span>
                </label>
              </div>
            </form>
          </div>

          <div id="collections">

            <h1>Táknasöfn</h1>
            <div class="row row-border sign collection-row">
              <span class="collection-name">Öll tákn</span>
              <span class="collection-count">13.105</span>
            </div>

            <div class="row sign collection-row">
              <span class="collection-name">Þroskaþjálfafræði</span>
              <span class="collection-count">64</span>
            </div>

            <div class="row sign collection-row">
              <span class="collection-name">Vinna</span>
              <span class="collection-count">91</span>
            </div>

            <div class="row sign collection-row">
              <span class="collection-name">Matur</span>
              <span class="collection-count">78</span>
            </div>
            
            <div class="user-collections"></div>
            
            <div class="row sign collection-row">
              <input type="text" id="newCollectionName"><button onclick="addCollection()">Add collection</button>
            </div>
          </div>
        </main>
          
          <footer>
            <nav>
              <a class="nav-item" href="/#"><span class="material-symbols-outlined">home</span><span class="nav-text">Heim</span></a>
              <a class="nav-item" href="/#allsigns"><span class="material-symbols-outlined">sign_language</span><span class="nav-text">Öll tákn</span></a>
              <a class="nav-item" href="/#collections"><span class="material-symbols-outlined">list</span><span class="nav-text">Táknasöfn</span></a>
              <a class="nav-item" href="/#settings"><span class="material-symbols-outlined">account_box</span><span class="nav-text">Stillingar</span></a>
              <a class="nav-item" href="/sponson.html"><span class="material-symbols-outlined">book</span><span class="nav-text">Stillingar</span></a>
              <!-- <a class="nav-item" href="/#settings"><span class="material-symbols-outlined">settings</span><span class="nav-text">Stillingar</span></a> -->
            </nav>
          </footer>
    </article>

</body>
<script>
  let currentSignOffset = 0
  let signQueryCount = 500
  window.addEventListener('scroll', () => {
        // console.log('scroll')
        let bottomOfWindow = Math.max(window.pageYOffset, document.documentElement.scrollTop, document.body.scrollTop) + window.innerHeight >= (document.documentElement.offsetHeight - 100)
        if (bottomOfWindow) {
            hitWindowBottom()
        }
        let el = document.getElementById('signs')
        let bottomOfElement = el.scrollHeight - el.scrollTop - el.clientHeight < 1
        if(bottomOfElement){
          hitWindowBottom()
        }
    })

    function hitWindowBottom() {
    console.log('bottom')
    if(currentSignOffset != 0){
      currentSignOffset += signQueryCount
      updateSearch()
    }
}
  function updateSearch(){
    
    console.log('update')
    if(!window.worker){
      setTimeout(updateSearch, 150)
      return
    }
    let inp = document.querySelector('#search-input')

    window.worker.postMessage({
      type:'searchValue',
      searchValue:inp.value,
      currentSignOffset,
      signQueryCount
  })
  }
  window.updateSearch = updateSearch

updateSearch()
</script>



<script>
  let heading = document.querySelector('.heading')
  let searchInput = document.querySelector('.sign-search')
  let containerDiv = document.querySelector('.container')
  let resultsDiv = document.querySelector('#results')
  let settingsDiv = document.querySelector('#settings')
  let collectionsDiv = document.querySelector('#collections')
  let userCollectionsDiv = document.querySelector('.user-collections')

  let newCollectionName = document.querySelector('#newCollectionName')
  
  heading.addEventListener('click',() => {
    containerDiv.scroll({behavior:'smooth',top:0})
  })

  function collectionsPage(){
    if(!window.worker){
      setTimeout(collectionsPage,150)
      return
    }
    searchInput.style.visibility = 'hidden'
    searchInput.style.display = 'none'
    resultsDiv.style.display = 'none'
    settingsDiv.style.display = 'none'
    settingsDiv.style.visibility = 'hidden'
    collectionsDiv.style.visibility = ''
    collectionsDiv.style.display = ''
    // collectionsDiv.innerHTML = 'lol'
    window.worker.postMessage({type:'user-collections'})
  }

  function indexPage(){
    allSignsPage()
    // searchInput.style.visibility = 'hidden'
    // searchInput.style.display = 'none'
    // resultsDiv.style.visibility = 'hidden'
    // settingsDiv.style.display = 'none'
    // collectionsDiv.style.visibility = 'hidden'
    // collectionsDiv.style.display = 'none'
  }

  function allSignsPage(){
    results.style.visibility = ''
    results.style.display = ''
    searchInput.style.visibility = ''
    searchInput.style.display = ''
    settingsDiv.style.display = 'none'
    collectionsDiv.style.visibility = 'hidden'
    collectionsDiv.style.display = 'none'
    updateSearch()
  }

  function settingsPage(){
    searchInput.style.visibility = 'hidden'
    searchInput.style.display = 'none'
    resultsDiv.style.display = 'none'
    settingsDiv.style.display = ''
    settingsDiv.style.visibility = ''
    collectionsDiv.style.visibility = 'hidden'
    collectionsDiv.style.display = 'none'
  }

  function addCollection(){
    let val = newCollectionName.value
    window.worker.postMessage({type:'new-collection',newCollectionName:val})
  }


  function handleHashUrl(){
    switch(location.hash){
      case '#':
        // console.log('collections');
        indexPage();
        break;
      case '':
        console.log('index');
        indexPage();
        break;
      case '#allsigns':
        allSignsPage();
        break;
      case '#settings':
        settingsPage();
        break;
      case '#collections':
        collectionsPage();
        break;
      default:
        console.log(location.hash);

        break;
    }
  }

  window.addEventListener('hashchange',handleHashUrl)
  handleHashUrl()
  // searchInput.style.display = 'none'
</script>
<script type="text/babel">
  async function showYoutube(el){       
  let removed = false
  for(let child of el.children){
      if(child.classList.contains('sign-video')){
          el.classList.remove('selected')
          console.log(child.classList)
          el.removeChild(child)
          removed = true
      }
  }
  if(!removed){
      el.classList.add('selected')
      let yt_id = el.attributes['youtube_id'].nodeValue
      let youtubeElement = document.createElement('div')
      youtubeElement.classList.add('sign-video')
      youtubeElement.setAttribute("display", "inline-block");
      youtubeEmbedUrl = `https://www.youtube.com/embed/${yt_id}?autoplay=1&loop=1&rel=0&controls=0&mute=1&playsinline=0&playlist=${yt_id}`
      fetch(youtubeEmbedUrl, {mode:'no-cors'}).then(res => {
          const iframe = document.createElement("iframe");
          iframe.setAttribute("src", youtubeEmbedUrl);
          iframe.allowFullscreen = true;
          youtubeElement.appendChild(iframe)
      })
      el.appendChild(youtubeElement)

  }
}


  'use strict';


  const YoutubeEmbed = ({ embedId }) => (
    <div className="video-responsive">
      <iframe
        width="853"
        height="480"
        src={`https://www.youtube.com/embed/${embedId}`}
        frameBorder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowFullScreen
        title="Embedded youtube"
      />
    </div>
  );

  class Sign extends React.Component {
    constructor(props) {
      super(props)
      this.state = { youtubeShowing: false }
      this.showYt = this.showYt.bind(this)
      this.youtube_id = props.sign.youtube_id
    }

    async showYt() {
      // await fetch(`https://www.youtube.com/embed/${this.youtube_id}?autoplay=1&loop=1&rel=0&controls=0&mute=1&playsinline=0&playlist=${this.youtube_id}`, {mode:'no-cors'})
      this.setState({youtubeShowing: !this.state.youtubeShowing})
      // console.log('lol show yt', this.state.youtubeShowing, this.youtube_id)
      
    }

    render() {
      const { sign } = this.props
      console.log('render,', sign)
      const yt = this.state.youtubeShowing 
      console.log(yt)
      return (
        <div className="sign" onClick={() => this.showYt()} id={sign.id} youtube_id={sign.youtube_id}>
          <div className="sign-phrase">
              <span>{sign.phrase}</span>
          </div>
          
          {yt && <YoutubeEmbed embedId={sign.youtube_id} />}
       </div>
      )
    }
  }
  
  class SignList extends React.Component {
    constructor(props) {
      super(props);
      window.worker.onmessage = (ev) => {
      console.log('react',ev.data)
      if(ev.data == 'ready'){
        window.updateSearch()
      } 
      if(ev.data.type === 'signs') {
        let div = document.getElementById('results')
        // console.log('fyrir json parse')
        let signs = ev.data.signs || [];
        if(!signs.length){return}
        if(!signs[0].phrase){return}
        if(signs.length){
          this.setState({signs:signs})
        //   div.innerHTML = signs.map(sign => {
        //     return `<div class="sign" onclick="showYoutube(this)" id="${sign.id}" youtube_id="${sign.youtube_id}">
        //                 <div class="sign-phrase">
        //                     <span>${sign.phrase}</span>
        //                     <span class="addToListIcon" onclick="addToList(${sign.id})">
        //                 </div>
        //             </div>`
        // }).join('')
        }
      }
      if(ev.data.type === 'user-collections'){
        console.log(ev.data.user_collections)
        document.querySelector('.user-collections').innerHTML = ev.data.user_collections.map(collection => {
          return `<div class="row sign collection-row">
          <span class="collection-name">${collection.name}</span>
          <span class="collection-count">91</span>
        </div>`
        }).join('')
      }

      }
      this.state = { signs:[] };
    }
  
    render() {
      if (this.state.liked) {
        return 'lol';
      }
  
      return (<div id="signs">
        {this.state.signs.map(sign => {
          return <Sign sign={sign} key={sign.id}/>
        })}
        </div>
      )
      // return e(
      //   'button',
      //   { onClick: () => this.setState({ liked: true }) },
      //   'Like'
      // );
    }
  }
  
  const domContainer = document.querySelector('#app');
  const root = ReactDOM.createRoot(domContainer);
  root.render(<SignList/>);
  </script>
<!-- <script async defer src="main.js"></script> -->
</html>